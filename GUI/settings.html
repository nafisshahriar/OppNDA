<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scenario Settings</title>
    <link rel="stylesheet" href="/GUI/settings.css">
    <link rel="stylesheet" href="/GUI/styles.css">
    <link rel="stylesheet" href="/GUI/directory-browser.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <link rel="icon" href="/GUI/images/oppnda_logo.png" type="image/png">
    <!-- Tagify CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.css">
    <!-- Tagify JS -->
    <script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify"></script>
</head>

<body>

    <!-- Quick Start Modal -->
    <div id="quickStartModal" class="quick-start-modal" onclick="if(event.target === this) closeQuickStart();">
        <div class="quick-start-content" onclick="event.stopPropagation()">
            <button class="quick-start-close" onclick="closeQuickStart()">&times;</button>
            <div class="quick-start-header">
                <img src="/GUI/images/oppnda_logo.png" alt="OppNDA" style="width: 60px; margin-bottom: 10px;">
                <h2>Welcome to OppNDA!</h2>
                <p style="color: #64748b;">Network Data Analyzer for ONE Simulator</p>
            </div>

            <div class="quick-start-steps">
                <div class="step-card" onclick="openTab(null, 'ScenarioSettings'); closeQuickStart();">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h3><i class="fas fa-cog"></i> Configure</h3>
                        <p>Set scenario name, nodes, routers, and simulation parameters</p>
                    </div>
                </div>

                <div class="step-card" onclick="openTab(null, 'UpdateConfiguration'); closeQuickStart();">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h3><i class="fas fa-play"></i> Run</h3>
                        <p>Execute ONE simulator with your configuration</p>
                    </div>
                </div>

                <div class="step-card" onclick="openTab(null, 'DataAnalysis'); closeQuickStart();">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h3><i class="fas fa-chart-bar"></i> Analyze</h3>
                        <p>View plots and compare router performance</p>
                    </div>
                </div>
            </div>

            <div class="quick-start-actions">
                <button class="btn-example" onclick="loadExampleScenario('urban'); closeQuickStart();">
                    <i class="fas fa-city"></i> Load Urban Example
                </button>
                <button class="btn-example" onclick="loadExampleScenario('campus'); closeQuickStart();">
                    <i class="fas fa-university"></i> Load Campus Example
                </button>
            </div>

            <div style="margin-top: 20px;">
                <label style="color: #64748b; font-size: 13px;">
                    <input type="checkbox" id="dontShowAgain" style="margin-right: 8px;">
                    Don't show this again
                </label>
            </div>
        </div>
    </div>

    <div id="tabs">
        <div class="sidebar-logo">
            <img src="/GUI/images/o4.png" alt="Sidebar Logo">
        </div>

        <!-- Settings Section with Collapsible Sub-tabs -->
        <div class="sidebar-section">
            <button class="section-header active" onclick="toggleSettingsMenu(event)">
                <i class="fas fa-cog"></i> Settings
                <i class="fas fa-chevron-down section-chevron"></i>
            </button>
            <div class="settings-submenu" id="settingsSubmenu">
                <button class="tablinks sub-tab active" onclick="openTab(event, 'ScenarioSettings')">
                    <span class="tab-step">1</span> Scenario
                </button>
                <button class="tablinks sub-tab" onclick="openTab(event, 'InterfaceSettings')">
                    <span class="tab-step">2</span> Interface
                </button>
                <button class="tablinks sub-tab" onclick="openTab(event, 'GroupSettings')">
                    <span class="tab-step">3</span> Nodes
                </button>
                <button class="tablinks sub-tab" onclick="openTab(event, 'ReportSettings')">
                    <span class="tab-step">4</span> Reports
                </button>
                <button class="tablinks sub-tab" onclick="openTab(event, 'EventSettings')">
                    <span class="tab-step">5</span> Events
                </button>
                <button class="tablinks sub-tab" onclick="openTab(event, 'OverlayMovement')">
                    <span class="tab-step">6</span> Movement
                </button>
                <button class="tablinks sub-tab" onclick="openTab(event, 'PostProcessing')">
                    <span class="tab-step">7</span> Post-Processing
                </button>
            </div>
        </div>

        <!-- Run Section -->
        <button class="tablinks run-tab main-section" onclick="openTab(event, 'UpdateConfiguration')">
            <i class="fas fa-play"></i> Run
        </button>

        <!-- Results Section -->
        <button class="tablinks results-tab main-section active" onclick="openTab(event, 'DataAnalysis')">
            <i class="fas fa-chart-bar"></i> Results
        </button>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                document.getElementById("ScenarioSettings").style.display = "block";
                // Show Quick Start for first-time users
                if (!localStorage.getItem('oppnda_quickstart_seen')) {
                    document.getElementById('quickStartModal').style.display = 'flex';
                }
            });

            function toggleSettingsMenu(event) {
                event.stopPropagation();
                const submenu = document.getElementById('settingsSubmenu');
                const header = event.currentTarget;
                const chevron = header.querySelector('.section-chevron');

                if (submenu.classList.contains('collapsed')) {
                    submenu.classList.remove('collapsed');
                    chevron.style.transform = 'rotate(0deg)';
                } else {
                    submenu.classList.add('collapsed');
                    chevron.style.transform = 'rotate(-90deg)';
                }
            }
        </script>

        <div class="group-logo-button">
            <h4>Developed by</h4>
            <img src="/GUI/images/rglogo.png" alt="Group Logo" onclick="openTab(event, 'MembersPage')">
        </div>
    </div>
    <br><br><br>

    <!-- Scenario Settings -->

    <div id="ScenarioSettings" class="tabcontent">
        <div class="banner-image" style="flex: 1;">
            <img src="/GUI/images/o8.png" alt="Banner Image" style="width: 100%; height: auto; border-radius: 1%;">
        </div>

        <!-- Import ONE Configuration - Below Banner -->
        <div class="import-section"
            style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 8px; padding: 15px 20px; margin: 15px 0; border: 1px solid #bae6fd;">
            <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                <span style="font-weight: 600; color: #0369a1;">
                    <i class="fas fa-file-import"></i> Import Config:
                </span>
                <input type="file" id="importConfigFile" accept=".txt"
                    style="flex: 1; min-width: 200px; padding: 8px; border: 1px solid #7dd3fc; border-radius: 6px; background: white;">
                <button type="button" class="edit-button" onclick="importONEConfig()" style="white-space: nowrap;">
                    <i class="fas fa-upload"></i> Import
                </button>
                <span id="importStatus" style="color: #64748b; font-size: 13px;"></span>
            </div>
        </div>

        <div class="split-container">
            <!-- Left side: Scenario Settings -->
            <div>
                <h2>Scenario Settings</h2>
                <form id="scenarioForm" class="scenario-grid">

                    <div class="form-group">
                        <label for="scenarioName"
                            data-tooltip="Unique identifier for this simulation run. Used in output file names.">Scenario
                            Name:</label>
                        <input type="text" id="scenarioName" name="scenarioName" value="default_scenario">
                    </div>

                    <div class="checkbox-container">
                        <input type="checkbox" id="nameAdd">
                        <label for="nameAdd"
                            data-tooltip="Appends timestamp to scenario name for unique identification.">Include Time &
                            Date</label>
                    </div>

                    <div class="checkbox-container">
                        <input type="checkbox" id="simulateConnections" name="simulateConnections" checked>
                        <label for="simulateConnections"
                            data-tooltip="Enable to simulate wireless connections between nodes. Required for message transfer.">Simulate
                            Connections</label>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="updateInterval"
                                data-tooltip="Time between simulation updates. Lower = more precision but slower. Typical: 0.1-1.0s">Update
                                Interval (seconds):</label>
                            <input type="number" id="updateInterval" name="updateInterval" value="0.1" step="0.1"
                                min="0">
                        </div>


                        <div class="form-group">
                            <label for="endTime"
                                data-tooltip="Total simulation duration. 43200s = 12 hours, 86400s = 24 hours.">End Time
                                (seconds):</label>
                            <input type="number" id="endTime" name="endTime" value="43200" min="0" max="604800">
                        </div>
                    </div>
                </form>
            </div>

            <!-- Right side: WKT Generator -->
            <div class="wkt-form-container">
                <h2><i class="fas fa-map-marked-alt"></i> WKT Generator</h2>
                <form id="wktMapForm" action="http://localhost:5000/generate" method="POST" target="_blank">
                    <div class="form-group">
                        <label for="wkt_location">
                            <i class="fas fa-map-marker-alt"></i> Location
                        </label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="wkt_location" name="location"
                                placeholder="Enter city name (e.g., Dhaka, Bangladesh)" required>
                            <button type="button" class="full-width-button" id="wktTestLocation">
                                <i class="fas fa-search"></i> Test
                            </button>
                        </div>
                        <div id="wktLocationStatus" style="display: none;" class="alert"></div>
                    </div>

                    <div class="form-group">
                        <label for="wkt_map_size">
                            <i class="fas fa-expand-arrows-alt"></i> Map Size (meters)
                        </label>
                        <input type="number" class="form-control" id="wkt_map_size" name="map_size" value="5000"
                            min="500" max="50000">
                    </div>

                    <div class="form-group">
                        <label>Detail Level</label>
                        <div class="form-row">
                            <label class="checkbox-group">
                                <input type="radio" name="detail_level" value="detailed" checked>
                                Detailed
                            </label>
                            <label class="checkbox-group">
                                <input type="radio" name="detail_level" value="simplified">
                                Simplified
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="wkt_output_name">
                            <i class="fas fa-file-alt"></i> Output Filename
                        </label>
                        <input type="text" class="form-control" id="wkt_output_name" name="output_name"
                            placeholder="e.g., dhaka_map" required pattern="[a-zA-Z0-9_-]+">
                    </div>

                    <button type="submit" class="full-width-button">
                        <i class="fas fa-map"></i> Generate WKT Map
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Interface Tab -->
    <div id="InterfaceSettings" class="tabcontent">
        <h2>Interface Settings</h2>

        <!-- Form for Adding New Interface -->
        <form id="newInterfaceForm" class="interface-grid">

            <div class="form-group">
                <div class="hover-container">
                    <div class="form-group">
                        <label for="interfaceName" class="hover-text"
                            data-tooltip="Unique name for this interface. Example: btInterface, wifiInterface">Interface
                            Name:</label>
                        <input type="text" id="interfaceName" name="interfaceName" required>
                    </div>
                    <div class="hover-tooltip">Transmit speed of the interface (bytes per second)</div>
                </div>

                <div class="form-group">
                    <label for="interfaceType"
                        data-tooltip="Interface class. SimpleBroadcast = basic radio, InterferenceLimited = accounts for signal interference.">Type:</label>
                    <select id="interfaceType" name="interfaceType" required>
                        <option value="SimpleBroadcastInterface">Simple Broadcast Interface</option>
                        <option value="InterferenceLimitedInterface">Interference Limited Interface</option>
                        <option value="DistanceCapacityInterface">Distance Capacity Interface</option>
                        <option value="ConnectivityOptimizer">Connectivity Optimizer</option>
                        <option value="ConnectivityGrid">Connectivity Grid</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="transmitSpeed"
                        data-tooltip="Data transfer rate in bytes/sec. 250k = Bluetooth (~2Mbps), 10M = WiFi.">Transmit
                        Speed:</label>
                    <input type="number" id="transmitSpeed" name="transmitSpeed" required min="1">
                </div>
                <div class="form-group">
                    <label for="transmitRange"
                        data-tooltip="Maximum communication distance in meters. Bluetooth ≈ 10m, WiFi ≈ 100m.">Transmit
                        Range:</label>
                    <input type="number" id="transmitRange" name="transmitRange" required min="1">
                </div>

            </div>

            <div class="form-row">
                <button type="button" class="add-button"
                    style="font-size: 1rem; padding-top: 0.8%; padding-bottom: 0.8%;" onclick="addInterface()">Add
                    Interface</button>
                <button type="button" class="remove-button"
                    style="font-size: 1rem; padding-top: 0.8%; padding-bottom: 0.8%;" onclick="removeInterface()">Remove
                    All Interfaces</button>
            </div>
        </form>
        <br>

        <h3>Interface List</h3>
        <!-- Interface List Table -->
        <table border="1px" id="interfaceList">
            <thead>
                <tr>
                    <th>Interface Name</th>
                    <th>Type</th>
                    <th>Transmit Speed</th>
                    <th>Transmit Range</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <!-- Default Interfaces will be displayed here by JavaScript -->
            </tbody>
        </table>
    </div>


    <!-- Group Settings -->
    <div id="GroupSettings" class="tabcontent">
        <h2>Group Settings</h2>
        <!-- Group Tab Form -->
        <!-- Common Group Settings Form -->

        <form id="commonGroupSettingsForm" class="interface-grid">

            <h3>Common Group Settings</h3>

            <div class="form-group">
                <label for="commonMovementModel"
                    data-tooltip="How nodes move in simulation. Map-based requires map files, Random moves freely.">Movement
                    Model:</label>
                <select id="commonMovementModel" name="movement">
                    <option value="BusControlSystem">Bus Control System</option>
                    <option value="BusMovement">Bus Movement</option>
                    <option value="BusTravellerMovement">Bus Traveller Movement</option>
                    <option value="CarMovement">Car Movement</option>
                    <option value="ClusterMovement">Cluster Movement</option>
                    <option value="EveningActivityControlSystem">Evening Activity Control System</option>
                    <option value="EveningActivityMovement">Evening Activity Movement</option>
                    <option value="EveningTrip">Evening Trip</option>
                    <option value="ExtendedMovementModel">Extended Movement Model</option>
                    <option value="ExternalMovement">External Movement</option>
                    <option value="ExternalPathMovement">External Path Movement</option>
                    <option value="GridLocation">Grid Location</option>
                    <option value="HomeActivityMovement">Home Activity Movement</option>
                    <option value="LinearFormation">Linear Formation</option>
                    <option value="LinearMovement">Linear Movement</option>
                    <option value="MapBasedMovement">Map Based Movement</option>
                    <option value="MapRouteMovement">Map Route Movement</option>
                    <option value="ModifiedRandomDirection">Modified Random Direction</option>
                    <option value="MovementModel">Movement Model</option>
                    <option value="OfficeActivityMovement">Office Activity Movement</option>
                    <option value="RandomDirection">Random Direction</option>
                    <option value="RandomWalk">Random Walk</option>
                    <option value="RandomWaypoint">Random Waypoint</option>
                    <option value="ShortestPathMapBasedMovement">Shortest Path Map Based Movement</option>
                    <option value="StationaryMovement">Stationary Movement</option>
                    <option value="SwitchableMovement">Switchable Movement</option>
                    <option value="TransportMovement">Transport Movement</option>
                    <option value="WorkingDayMovement">Working Day Movement</option>
                </select>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="commonRouter"
                        data-tooltip="Routing protocol for message forwarding. Epidemic floods all, Prophet uses history. Use semicolons for batch runs.">Router:</label>
                    <input id="commonRouter" name="router" placeholder="Choose router(s)" value="EpidemicRouter"
                        required>
                </div>
                <script>
                    document.addEventListener("DOMContentLoaded", function () {
                        var input = document.getElementById('commonRouter');
                        var routerTagify = new Tagify(input, {
                            whitelist: [
                                "EpidemicRouter",
                                "ProphetRouter",
                                "SprayAndWaitRouter",
                                "PassiveRouter",
                                "DirectDeliveryRouter",
                                "FirstContactRouter",
                                "MaxPropRouter",
                                "EpidemicOracleRouter",
                                "ProphetV2Router",
                                "LifeRouter"
                            ],
                            enforceWhitelist: false,
                            dropdown: {
                                maxItems: 10,
                                enabled: 0,
                                closeOnSelect: false
                            }
                        });

                        // Store globally for batch preview access
                        window.routerTagify = routerTagify;

                        // Update batch preview when routers change
                        // Use a function that checks if updateBatchPreview exists
                        function triggerBatchUpdate() {
                            if (typeof window.updateBatchPreview === 'function') {
                                window.updateBatchPreview();
                            }
                        }

                        routerTagify.on('add', triggerBatchUpdate);
                        routerTagify.on('remove', triggerBatchUpdate);
                    });
                </script>




                <div class="form-group">
                    <label for="commonInterface"
                        data-tooltip="Network interfaces for this group. Select multiple for nodes with multiple radios.">Interface(s):</label>
                    <input id="commonInterface" name="interface" placeholder="Select interface(s)" value="btInterface">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="commonBufferSize"
                        data-tooltip="Message storage capacity per node. 5M = 5 megabytes. Larger = more messages but slower.">Buffer
                        Size (Example: 5M):</label>
                    <input type="text" id="commonBufferSize" name="bufferSize" value="5M">
                </div>
                <div class="form-group">
                    <label for="commonWaitTime"
                        data-tooltip="Min/max seconds to wait at each destination before moving. Format: min, max">Wait
                        Time (Example: 0, 120):</label>
                    <input type="text" id="commonWaitTime" name="WaitTime" value="0, 120">
                </div>
            </div>
            <br>
            <div class="form-group">
                <label for="commonRouteFile"
                    data-tooltip="WKT file defining routes for MapRouteMovement. Required for route-based models.">Route
                    File:</label>
                <input type="file" id="commonRouteFile" name="RouteFile" accept=".wkt"><br>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="commonSpeed"
                        data-tooltip="Node movement speed in m/s. Walking: 0.5-1.5, Car: 10-20. Format: min, max">Speed
                        (Example: 0.5, 1.5 (Walking Speed)):</label>
                    <input type="text" id="commonSpeed" name="Speed" value="0.5, 1.5">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="commonTtl"
                        data-tooltip="Message Time-To-Live in minutes. Messages expire after this. Use semicolons for batch.">TTL
                        (Message TTL of 300 minutes (5 hours)):</label>
                    <input type="text" id="commonTtl" name="commonTtl" value="300"><br>
                </div>

                <div class="form-group">
                    <label for="commonNumberOfHost"
                        data-tooltip="Number of nodes in this group. Total nodes = sum of all groups.">Number of
                        Hosts:</label>
                    <input type="number" id="commonNumberOfHost" name="commonNumberOfHost" value="40">
                </div>
            </div>
            <br>
        </form>

        <h3>Router & Optimization Settings</h3>
        <br>
        <form id="RouterOptimizationForm">
            <div class="form-row">
                <!-- Prophet Router Settings -->
                <fieldset>
                    <legend>ProphetRouter Settings</legend>

                    <label for="prophetRouterTimeUnit"
                        data-tooltip="Time unit for Prophet predictability decay. Lower = faster decay.">Seconds in Time
                        Unit:</label>

                    <input type="number" id="prophetRouterTimeUnit" name="prophetRouterTimeUnit" value="30">
                </fieldset>

                <!-- Spray and Wait Router Settings -->
                <fieldset>
                    <legend>SprayAndWaitRouter Settings</legend>

                    <label for="sprayAndWaitCopies"
                        data-tooltip="Initial message copies in Spray-and-Wait. Higher = more delivery chance, more overhead.">Number
                        of Copies:</label>
                    <input type="number" id="sprayAndWaitCopies" name="sprayAndWaitCopies" value="6">
                    <br>
                    <br>
                    <label for="sprayAndWaitBinaryMode"
                        data-tooltip="Binary mode splits copies in half on forward. More efficient than source spray.">Binary
                        Mode:</label>
                    <input type="checkbox" id="sprayAndWaitBinaryMode" name="sprayAndWaitBinaryMode" checked>
                </fieldset>

                <!-- Optimization Settings -->
                <fieldset>
                    <legend>Optimization Settings</legend>

                    <label for="optimizationCellSizeMult"
                        data-tooltip="Grid cell size for connection checking. Higher = faster but less accurate.">Cell
                        Size Multiplier:</label>
                    <input type="number" id="optimizationCellSizeMult" name="optimizationCellSizeMult" value="5">
                    <br>
                    <br>
                    <label for="optimizationRandomizeUpdateOrder"
                        data-tooltip="Randomize node update order to avoid systematic bias in message forwarding.">Randomize
                        Update Order:</label>
                    <input type="checkbox" id="optimizationRandomizeUpdateOrder" name="optimizationRandomizeUpdateOrder"
                        checked>
                </fieldset>
            </div>
        </form>

        <!-- Energy Model Settings -->
        <br>
        <fieldset id="energySettingsFieldset">
            <legend><i class="fas fa-bolt"></i> Energy Model Settings</legend>

            <div class="checkbox-container">
                <input type="checkbox" id="enableEnergyModel" name="enableEnergyModel">
                <label for="enableEnergyModel"
                    data-tooltip="Enable energy consumption simulation. Nodes can run out of battery and stop forwarding.">Enable
                    Energy Model</label>
            </div>

            <div id="energyFields" style="display: none;">
                <br>
                <div class="form-row">
                    <div class="form-group">
                        <label for="initialEnergy"
                            data-tooltip="Starting energy level for each node. Higher = longer node lifetime.">Initial
                            Energy (units):</label>
                        <input type="number" id="initialEnergy" name="initialEnergy" value="100" min="0">
                    </div>
                    <div class="form-group">
                        <label for="scanEnergy"
                            data-tooltip="Energy consumed per neighbor discovery scan. Frequent scanning drains battery.">Scan
                            Energy (units/scan):</label>
                        <input type="number" id="scanEnergy" name="scanEnergy" value="0.1" step="0.01" min="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="transmitEnergy"
                            data-tooltip="Energy cost per byte transmitted. Large messages consume more energy.">Transmit
                            Energy (units/byte):</label>
                        <input type="number" id="transmitEnergy" name="transmitEnergy" value="0.001" step="0.0001"
                            min="0">
                    </div>
                    <div class="form-group">
                        <label for="baseEnergy"
                            data-tooltip="Idle power consumption per second. Simulates always-on radio circuits.">Base
                            Energy (units/sec):</label>
                        <input type="number" id="baseEnergy" name="baseEnergy" value="0.01" step="0.001" min="0">
                    </div>
                </div>
                <p class="form-hint">
                    <i class="fas fa-info-circle"></i> Energy consumption: base + scan per discovery + transmit per byte
                    sent
                </p>
            </div>
        </fieldset>

        <form id="newGroupForm">
            <br>
            <h3>Custom Groups</h3>
            <div class="form-row">
                <div class="form-group">
                    <label for="groupID">Group ID:</label>
                    <input type="text" id="groupID" name="groupID" required><br>
                </div>
                <div class="form-group">
                    <label for="numberOfHosts">Number of Hosts:</label>
                    <input type="number" id="numberOfHosts" name="numberOfHosts" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="Movement">Movement Model:</label>
                    <select id="Movement" name="Movement">
                        <option value="BusControlSystem">Bus Control System</option>
                        <option value="BusMovement">Bus Movement</option>
                        <option value="BusTravellerMovement">Bus Traveller Movement</option>
                        <option value="CarMovement">Car Movement</option>
                        <option value="ClusterMovement">Cluster Movement</option>
                        <option value="EveningActivityControlSystem">Evening Activity Control System</option>
                        <option value="EveningActivityMovement">Evening Activity Movement</option>
                        <option value="EveningTrip">Evening Trip</option>
                        <option value="ExtendedMovementModel">Extended Movement Model</option>
                        <option value="ExternalMovement">External Movement</option>
                        <option value="ExternalPathMovement">External Path Movement</option>
                        <option value="GridLocation">Grid Location</option>
                        <option value="HomeActivityMovement">Home Activity Movement</option>
                        <option value="LinearFormation">Linear Formation</option>
                        <option value="LinearMovement">Linear Movement</option>
                        <option value="MapBasedMovement">Map Based Movement</option>
                        <option value="MapRouteMovement">Map Route Movement</option>
                        <option value="ModifiedRandomDirection">Modified Random Direction</option>
                        <option value="MovementModel">Movement Model</option>
                        <option value="OfficeActivityMovement">Office Activity Movement</option>
                        <option value="RandomDirection">Random Direction</option>
                        <option value="RandomWalk">Random Walk</option>
                        <option value="RandomWaypoint">Random Waypoint</option>
                        <option value="ShortestPathMapBasedMovement">Shortest Path Map Based Movement</option>
                        <option value="StationaryMovement">Stationary Movement</option>
                        <option value="SwitchableMovement">Switchable Movement</option>
                        <option value="TransportMovement">Transport Movement</option>
                        <option value="WorkingDayMovement">Working Day Movement</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="movementRouteType">Route Type:</label>
                    <select id="movementRouteType" name="movementRouteType">
                        <option value="1">Type 1</option>
                        <option value="2">Type 2</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="waitTimeMin">Wait Time Min (seconds):</label>
                    <input type="number" id="waitTimeMin" name="waitTimeMin">
                </div>
                <div class="form-group">
                    <label for="waitTimeMax">Wait Time Max (seconds):</label>
                    <input type="number" id="waitTimeMax" name="waitTimeMax">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="speedMin">Speed Min (m/s):</label>
                    <input type="number" step="0.1" id="speedMin" name="speedMin">
                </div>

                <div class="form-group">
                    <label for="speedMax">Speed Max (m/s):</label>
                    <input type="number" step="0.1" id="speedMax" name="speedMax">
                </div>
            </div>

            <br>
            <div class="form-group">
                <label for="router">Router:</label>
                <select id="router" name="router">
                    <option value="EpidemicRouter">Epidemic Router</option>
                    <option value="ProphetRouter">Prophet Router</option>
                    <option value="ProphetV2Router">Prophet V2 Router</option>
                    <option value="SprayAndWaitRouter">Spray And Wait Router</option>
                    <option value="DirectDeliveryRouter">Direct Delivery Router</option>
                    <option value="FirstContactRouter">First Contact Router</option>
                    <option value="MaxPropRouter">MaxProp Router</option>
                    <option value="PassiveRouter">Passive Router</option>
                    <option value="EpidemicOracleRouter">Epidemic Oracle Router</option>
                    <option value="LifeRouter">Life Router</option>
                </select>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="bufferSize">Buffer Size (bytes):</label>
                    <input type="number" id="bufferSize" name="bufferSize"><br>
                </div>
                <div class="form-group">
                    <label for="msgTtl">Message TTL:</label>
                    <input type="text" id="msgTtl" name="msgTtl" value="300"><br>
                </div>
            </div>
            <h3>Active Times (0 for disable it):</h3>
            <label for="activeTimeStart1">Active Time (start1, end1, start2, end2...):</label>
            <input type="text" id="activeTimeStart1" value="0"><br>

            <div class="form-row">
                <button type="submit" class="add-button"
                    style="font-size: 1rem; padding-top: 0.8%; padding-bottom: 0.8%;">Add Group</button>
                <button type="submit" class="remove-button"
                    style="font-size: 1rem; padding-top: 0.8%; padding-bottom: 0.8%;">Remove All Groups</button>
            </div>
        </form>
        <br><br>
        <h3>Group List</h3>
        <!-- Group List Table -->
        <table id="groupList">
            <thead>
                <tr>
                    <th>Group ID</th>
                    <th>Number of Hosts</th>
                    <th>Movement Model</th>
                    <th>Movement Route</th>
                    <th>Route Type</th>
                    <th>Router</th>
                    <th>Active Times</th>
                    <th>Message TTL</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

    </div>


    <div id="EventSettings" class="tabcontent">
        <h2>Event Settings</h2>
        <p style="color: #64748b; margin-bottom: 20px;">Configure message generation events for the simulation. Events
            define how and when messages are created between nodes.</p>

        <fieldset>
            <legend><i class="fas fa-plus-circle"></i> Add New Event</legend>
            <form id="newEventForm">
                <div class="form-group" style="margin-bottom: 16px;">
                    <label for="eventClass"
                        data-tooltip="Event generator class. MessageEventGenerator creates random messages between hosts.">Event
                        Class:</label>
                    <input type="text" id="eventClass" name="eventClass" value="MessageEventGenerator" readonly
                        style="background: #f1f5f9; max-width: 300px;">
                </div>

                <div class="form-group" style="margin-bottom: 16px;">
                    <label for="eventIntervalMin"
                        data-tooltip="Time between new message creation. E.g., 25-35 means one message every 25-35 seconds.">Creation
                        Interval (seconds):</label>
                    <div class="range-input-group">
                        <input type="number" id="eventIntervalMin" name="eventIntervalMin" value="25" required
                            style="width: 100px;">
                        <span class="range-separator">to</span>
                        <input type="number" id="eventIntervalMax" name="eventIntervalMax" value="35" required
                            style="width: 100px;">
                    </div>
                </div>

                <div class="form-group" style="margin-bottom: 16px;">
                    <label for="eventSizeMin"
                        data-tooltip="Message payload size range. Use k for kilobytes, M for megabytes. E.g., 500k to 1M.">Message
                        Size:</label>
                    <div class="range-input-group">
                        <input type="text" id="eventSizeMin" name="eventSizeMin" value="500k" required
                            style="width: 100px;" placeholder="e.g., 500k">
                        <span class="range-separator">to</span>
                        <input type="text" id="eventSizeMax" name="eventSizeMax" value="1M" required
                            style="width: 100px;" placeholder="e.g., 1M">
                    </div>
                    <p class="form-hint"><i class="fas fa-info-circle"></i> Use k for KB, M for MB (e.g., 500k, 1M)</p>
                </div>

                <div class="form-group" style="margin-bottom: 16px;">
                    <label for="eventHostsMin"
                        data-tooltip="Host address range for message source/destination. 0-126 means any host from 0 to 126.">Source/Destination
                        Hosts:</label>
                    <div class="range-input-group">
                        <input type="number" id="eventHostsMin" name="eventHostsMin" value="0" required
                            style="width: 100px;">
                        <span class="range-separator">to</span>
                        <input type="number" id="eventHostsMax" name="eventHostsMax" value="126" required
                            style="width: 100px;">
                    </div>
                    <p class="form-hint"><i class="fas fa-info-circle"></i> Host address range (typically 0 to total
                        hosts - 1)</p>
                </div>

                <div class="form-group" style="margin-bottom: 16px;">
                    <label for="eventPrefix"
                        data-tooltip="Prefix for message IDs. 'M' creates M1, M2, M3... for easy identification in logs.">Message
                        ID Prefix:</label>
                    <input type="text" id="eventPrefix" name="eventPrefix" value="M" required style="max-width: 100px;">
                </div>

                <div class="button-row" style="display: flex; gap: 12px; margin-top: 20px;">
                    <button type="button" class="add-button">
                        <i class="fas fa-plus"></i> Add Event
                    </button>
                    <button type="button" class="remove-button">
                        <i class="fas fa-trash"></i> Remove All Events
                    </button>
                </div>
            </form>
        </fieldset>

        <h3 style="margin-top: 25px;"><i class="fas fa-list" style="color: #10b981;"></i> Configured Events</h3>
        <table id="eventList">
            <thead>
                <tr>
                    <th>Event Class</th>
                    <th>Creation Interval (s)</th>
                    <th>Message Size</th>
                    <th>Hosts</th>
                    <th>Prefix</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <!-- Default Events will be displayed here by JavaScript -->
            </tbody>
        </table>
    </div>

    <!-- Movement Model Settings -->
    <div id="OverlayMovement" class="tabcontent">

        <form id="guiForm">
            <h2>GUI Settings</h2>
            <div class="form-group">
                <label for="underlayImageFileName">Overlay Image:</label>
                <b>Default: data/helsinki_underlay.png</b>
                <input type="file" id="underlayImageFileName" name="underlayImageFileName" accept="image/*">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="underlayImageOffset">Underlay Image Offset: </label>
                    <input type="text" id="underlayImageOffset" name="underlayImageOffset" value="64,20"
                        placeholder="Image offset in pixels (x, y) (Default: 64, 20)">
                </div>
                <div class="form-group">
                    <label for="underlayImageScale">Underlay Image Scale: </label>
                    <input type="number" id="underlayImageScale" name="underlayImageScale" value="4.75"
                        placeholder="Scaling factor for the image (Default: 4.75)">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="underlayImageRotate">Underlay Image Rotate: </label>
                    <input type="number" id="underlayImageRotate" name="underlayImageRotate" value="-0.015"
                        placeholder="Image rotation (radians) ( Default: -0.015)">
                </div>
                <div class="form-group">
                    <label for="eventLogPanelNrofEvents">Number of Events: </label>
                    <input type="number" id="eventLogPanelNrofEvents" name="eventLogPanelNrofEvents" value="100"
                        placeholder="how many events to show in the log panel (default = 100)">
                </div>
            </div>
        </form>
        <br>
        <br>
        <form id="movementModelForm">
            <h2>Movement Model Settings</h2>
            <!-- RNG Seed -->
            <div class="form-row">
                <div class="form-group">
                    <label for="rngSeed"
                        data-tooltip="Random number seed for reproducible runs. Use semicolons for batch runs: 1; 2; 3">RNG
                        Seed:</label>
                    <input type="text" id="rngSeed" name="rngSeed" value="1">
                </div>

                <div class="form-group">
                    <label for="warmup"
                        data-tooltip="Pre-simulation time to spread nodes before message events. Avoids clustering effects.">Warmup
                        Time (seconds):</label>
                    <input type="number" id="warmup" name="warmup" value="1000">
                </div>
            </div>
            <div class="form-group">
                <label for="worldSize"
                    data-tooltip="Simulation area dimensions. Should match map file boundaries. Format: width, height">World
                    Size (width, height in meters):</label>
                <input type="text" id="worldSize" name="worldSize" value="4500, 3400">
            </div>



            <div class="form-group">
                <label for="mapFiles"
                    data-tooltip="WKT map files defining roads, paths, and POIs. Required for map-based movement models.">Map
                    Files:</label>
                <input type="file" id="mapFiles" name="mapFiles[]" accept=".wkt" multiple>
            </div>
            <br>
            <h4>Selected Map Files:</h4>
            <ul id="fileList" style="list-style-type: disc; padding-left: 20px;"></ul>
        </form>

        <!-- POI Configuration -->
        <br>
        <h3><i class="fas fa-map-pin"></i> Points of Interest (POI)</h3>
        <p class="form-hint">
            Define probability of visiting different map areas. Used with ShortestPathMapBasedMovement.
        </p>

        <div class="checkbox-container">
            <input type="checkbox" id="poiEnabled" name="poiEnabled">
            <label for="poiEnabled"
                data-tooltip="Define probability-weighted destinations for ShortestPathMapBasedMovement.">Enable POI
                Configuration</label>
        </div>

        <div id="poiConfiguration" style="display: none;">
            <br>
            <table border="1px" id="poiTable">
                <thead>
                    <tr>
                        <th>POI Index</th>
                        <th>Probability (0-1)</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="poiTableBody">
                    <!-- Dynamic rows added here -->
                </tbody>
            </table>
            <br>
            <button type="button" class="add-button" onclick="addPOIRow()">
                <i class="fas fa-plus"></i> Add POI
            </button>

            <div class="form-group">
                <label for="poiPreview" data-tooltip="Formatted POI string that will be used in the config file.">POI
                    String Preview:</label>
                <input type="text" id="poiPreview" name="poiPreview" readonly
                    placeholder="e.g., 1, 0.3, 2, 0.5, 3, 0.2">
            </div>
        </div>

        <!-- Display selected map files -->

    </div>

    <!-- Report Settings -->
    <div id="ReportSettings" class="tabcontent">
        <h2>Report Settings</h2>

        <!-- Form for Adding New Reports -->
        <form id="newReportForm" class="interface-grid">

            <div class="form-group">
                <label for="reportClass"
                    data-tooltip="Report type to generate. MessageStatsReport gives overall delivery metrics.">Report
                    Class:</label>
                <select id="reportClass" name="reportClass" required>
                    <option value="AdjacencyGraphvizReport">AdjacencyGraphvizReport</option>
                    <option value="BufferOccupancyReport">BufferOccupancyReport</option>
                    <option value="ConnectivityDtnsim2Report">ConnectivityDtnsim2Report</option>
                    <option value="ConnectivityONEReport">ConnectivityONEReport</option>
                    <option value="ConnectivityReportConnector">ConnectivityReportConnector</option>
                    <option value="ContactsDuringAnICTReport">ContactsDuringAnICTReport</option>
                    <option value="ContactsPerHourReport">ContactsPerHourReport</option>
                    <option value="ContactTimesReport">ContactTimesReport</option>
                    <option value="CreatedMessagesReport">CreatedMessagesReport</option>
                    <option value="DeliveredMessagesReport">DeliveredMessagesReport</option>
                    <option value="DistanceDelayReport">DistanceDelayReport</option>
                    <option value="DTN2Reporter">DTN2Reporter</option>
                    <option value="EncountersVSUniqueEncountersReport">EncountersVSUniqueEncountersReport</option>
                    <option value="EnergyLevelReport">EnergyLevelReport</option>
                    <option value="EventLogReport">EventLogReport</option>
                    <option value="InterContactTimesReport">InterContactTimesReport</option>
                    <option value="JumpSizeDistributionReport">JumpSizeDistributionReport</option>
                    <option value="LocationSnapshotReport">LocationSnapshotReport</option>
                    <option value="MessageAvailabilityReport">MessageAvailabilityReport</option>
                    <option value="MessageCopyCountReport">MessageCopyCountReport</option>
                    <option value="MessageDelayReport">MessageDelayReport</option>
                    <option value="MessageDeliveryReport">MessageDeliveryReport</option>
                    <option value="MessageGraphvizReport">MessageGraphvizReport</option>
                    <option value="MessageLocationReport">MessageLocationReport</option>
                    <option value="MessageReport">MessageReport</option>
                    <option value="MessageStatsReport">MessageStatsReport</option>
                    <option value="MovementListenerTestReport">MovementListenerTestReport</option>
                    <option value="MovementNs2Report">MovementNs2Report</option>
                    <option value="NodeDensityReport">NodeDensityReport</option>
                    <option value="PingAppReporter">PingAppReporter</option>
                    <option value="RadiusOfGyrationReport">RadiusOfGyrationReport</option>
                    <option value="SamplingReport">SamplingReport</option>
                    <option value="SnapshotReport">SnapshotReport</option>
                    <option value="TotalContactTimeReport">TotalContactTimeReport</option>
                    <option value="TotalEncountersReport">TotalEncountersReport</option>
                    <option value="UniqueEncountersReport">UniqueEncountersReport</option>

                </select>
            </div>
            <div class="form-group">
                <label for="reportWarmup"
                    data-tooltip="Ignore data from this initial period. Avoids skewed results from startup transients.">Report
                    Warmup Time (Sec):</label>
                <input type="number" id="reportWarmup" name="reportWarmup" value="0">
            </div>

            <br>
            <div class="form-row">

                <input type="text" id="reportDir" name="reportDir" value="reports/" readonly>
                <button type="button" class="edit-button" id="browseDirButton">Browse</button>
                <button type="button" class="add-button" id="addReportButton">Add Report</button>

            </div>
        </form>
        <br>

        <!-- Table for Displaying Reports -->
        <table id="reportList">
            <thead>
                <tr>
                    <th>Report Class</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>


    <div id="UpdateConfiguration" class="tabcontent">

        <form class="interface-grid">
            <h2 style="margin-bottom: 0;"><i class="fas fa-play-circle" style="color: #10b981;"></i> Run Simulation</h2>

            <!-- Batch Preview -->
            <div class="batch-preview" id="batchPreviewContainer">
                <div class="batch-preview-icon">
                    <i class="fas fa-layer-group"></i>
                </div>
                <div class="batch-preview-text" id="batchCountPreview">
                    <h4>Batch Runs</h4>
                    <span>1</span>
                </div>
            </div>

            <div class="form-group" style="padding-bottom: 1vh;">
                <div class="checkbox-container" style="margin-top: 0;">
                    <input type="checkbox" id="compile" name="compile">
                    <label for="compile">Compile before running</label>
                </div>
            </div>

            <!-- Progress bar (hidden by default) -->
            <div id="simulationProgress" style="display: none;">
                <div class="progress-container">
                    <div class="progress-bar" id="progressBar" style="width: 0%;"></div>
                </div>
                <p class="progress-text" id="progressText">Preparing simulation...</p>
            </div>

            <div class="form-group">
                <button type="button" class="full-width-button" onclick="runONE()" id="runButton">
                    <i class="fas fa-play"></i> Run ONE Simulator and OppNDA
                </button>
            </div>
        </form>

        <!-- Post-Processing Only Section -->
        <fieldset
            style="margin-top: 20px; border: 2px dashed #64748b; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);">
            <legend><i class="fas fa-cogs"></i> Run Post-Processing Only</legend>
            <p style="color: #64748b; margin-bottom: 15px; font-size: 13px;">
                Run post-processing on existing report files without running simulation.
            </p>

            <div class="form-row" style="gap: 10px;">
                <button type="button" class="edit-button" onclick="runStreamingStep('averager')" style="flex: 1;">
                    <i class="fas fa-calculator"></i> Run Averager
                </button>
                <button type="button" class="edit-button" onclick="runStreamingStep('analysis')" style="flex: 1;">
                    <i class="fas fa-chart-line"></i> Run Analysis
                </button>
                <button type="button" class="edit-button" onclick="runStreamingStep('regression')" style="flex: 1;">
                    <i class="fas fa-brain"></i> Run Regression
                </button>
            </div>

            <div style="margin-top: 15px;">
                <button type="button" class="full-width-button" onclick="runAllStreamingSteps()"
                    style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);">
                    <i class="fas fa-layer-group"></i> Run All Post-Processing
                </button>
            </div>

            <!-- Post-processing output console -->
            <div id="postProcessingOutput" style="display: none; margin-top: 20px;">
                <div class="console-container">
                    <div class="console-header">
                        <div class="console-title">
                            <i class="fas fa-terminal"></i> Console Output
                        </div>
                        <div class="console-actions">
                            <button type="button" class="console-btn" onclick="clearConsole()" title="Clear">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                            <button type="button" class="console-btn" onclick="copyConsole()" title="Copy">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    <div id="postProcessingLog" class="console-body"></div>
                </div>
            </div>
        </fieldset>

    </div>

    <div id="DataAnalysis" class="tabcontent">
        <h2><i class="fas fa-chart-bar" style="color: #3b82f6;"></i> Data Analysis & Visualization</h2>
        <p style="color: #64748b; margin-bottom: 20px;">After running simulations and post-processing, view your
            analysis results including performance comparisons and statistical visualizations.</p>

        <button type="button" class="add-button" id="browseDirButton" onclick="window.location.href='/nda'"
            style="margin-bottom: 25px; padding: 12px 24px; font-size: 15px;">
            <i class="fas fa-chart-line"></i> Open Analysis Dashboard
        </button>

        <div
            style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border: 1px solid #e2e8f0; border-radius: 12px; padding: 24px;">
            <h3 style="color: #1e293b; margin-top: 0; margin-bottom: 20px; font-size: 18px;">
                <i class="fas fa-chart-pie" style="color: #8b5cf6; margin-right: 10px;"></i>Available Visualization
                Types
            </h3>

            <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; margin-bottom: 24px;">
                <!-- Correlation Heatmap -->
                <div style="background: white; border: 1px solid #e2e8f0; border-radius: 10px; padding: 16px;">
                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                        <div
                            style="width: 36px; height: 36px; background: linear-gradient(135deg, #ef4444, #f97316); border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                            <i class="fas fa-th" style="color: white;"></i>
                        </div>
                        <strong style="color: #1e293b; font-size: 15px;">Correlation Heatmap</strong>
                    </div>
                    <p style="color: #64748b; font-size: 13px; margin: 0; line-height: 1.5;">Shows correlations between
                        KPIs (delivery probability, latency, overhead ratio) for each router. Quickly identify which
                        metrics are related.</p>
                </div>

                <!-- Line Plot -->
                <div style="background: white; border: 1px solid #e2e8f0; border-radius: 10px; padding: 16px;">
                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                        <div
                            style="width: 36px; height: 36px; background: linear-gradient(135deg, #3b82f6, #6366f1); border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                            <i class="fas fa-chart-line" style="color: white;"></i>
                        </div>
                        <strong style="color: #1e293b; font-size: 15px;">Line Plot</strong>
                    </div>
                    <p style="color: #64748b; font-size: 13px; margin: 0; line-height: 1.5;">Compares router performance
                        across varying parameters (buffer size, TTL). Perfect for visualizing trends and finding optimal
                        configurations.</p>
                </div>

                <!-- Bar Plot -->
                <div style="background: white; border: 1px solid #e2e8f0; border-radius: 10px; padding: 16px;">
                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                        <div
                            style="width: 36px; height: 36px; background: linear-gradient(135deg, #10b981, #14b8a6); border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                            <i class="fas fa-chart-bar" style="color: white;"></i>
                        </div>
                        <strong style="color: #1e293b; font-size: 15px;">Bar Plot</strong>
                    </div>
                    <p style="color: #64748b; font-size: 13px; margin: 0; line-height: 1.5;">Direct router comparison
                        for fixed scenarios. Easily see which algorithm performs best under specific conditions.</p>
                </div>

                <!-- Pairplot -->
                <div style="background: white; border: 1px solid #e2e8f0; border-radius: 10px; padding: 16px;">
                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                        <div
                            style="width: 36px; height: 36px; background: linear-gradient(135deg, #f59e0b, #eab308); border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                            <i class="fas fa-project-diagram" style="color: white;"></i>
                        </div>
                        <strong style="color: #1e293b; font-size: 15px;">Pairplot</strong>
                    </div>
                    <p style="color: #64748b; font-size: 13px; margin: 0; line-height: 1.5;">Matrix of scatter plots
                        showing pairwise relationships between all KPIs. Discover hidden patterns in your data.</p>
                </div>
            </div>

            <div
                style="background: linear-gradient(135deg, #eff6ff 0%, #f0f9ff 100%); border: 1px solid #93c5fd; border-radius: 8px; padding: 16px;">
                <h4 style="color: #1e40af; margin: 0 0 12px 0; font-size: 14px;">
                    <i class="fas fa-lightbulb" style="margin-right: 8px;"></i>Quick Tips
                </h4>
                <ul style="margin: 0; padding-left: 20px; color: #475569; font-size: 13px; line-height: 1.8;">
                    <li><strong>Heatmaps</strong> reveal which KPIs are strongly correlated (positive or negative)</li>
                    <li><strong>Line Plots</strong> show performance trends as parameters change</li>
                    <li><strong>Bar Plots</strong> are best for comparing final metrics across routers</li>
                    <li><strong>Pairplots</strong> help identify outliers and non-linear relationships</li>
                    <li>Click on any plot to zoom in, use arrow keys to navigate</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Post-Processing Configuration -->
    <div id="PostProcessing" class="tabcontent">
        <h2>Post-Processing Configuration</h2>
        <p style="color: #64748b; margin-bottom: 20px;">Configure batch processing, analysis, and regression settings.
            Changes are saved automatically.</p>

        <!-- File Pattern Builder - Simple Version -->
        <fieldset id="filenamePatternSection" style="margin-bottom: 20px;">
            <legend><i class="fas fa-layer-group"></i> File Naming Pattern Builder</legend>
            <div id="patternBuilderContainer" style="padding: 20px;">
                <!-- Container will be filled by pattern-builder.js -->
            </div>
        </fieldset>

        <!-- Unified Post-Processing Settings -->
        <fieldset id="postProcessingConfigSection">
            <legend><i class="fas fa-cogs"></i> Report Processing Settings</legend>
            <form id="postProcessingForm">

                <!-- Shared Directories Section -->
                <h4 style="margin: 0 0 15px 0; color: #475569;"><i class="fas fa-folder-open"
                        style="color: #3b82f6;"></i> Directories</h4>
                <p style="color: #64748b; font-size: 13px; margin-bottom: 15px;">
                    <i class="fas fa-info-circle"></i> Use relative paths (e.g., <code>reports/</code>) or absolute
                    paths (e.g., <code>C:\simulations\reports</code>).
                </p>
                <div class="form-row">
                    <div class="form-group">
                        <label for="batchFolder"
                            data-tooltip="Directory containing ONE simulation reports. Relative paths are from ONE simulator directory.">
                            Report Folder:
                        </label>
                        <input type="text" id="batchFolder" name="folder" value="reports/"
                            placeholder="e.g., reports/ or C:\simulations\reports" style="flex: 1;">
                    </div>
                    <div class="form-group">
                        <label for="analysisPlotsDir"
                            data-tooltip="Directory where plots will be saved. Relative paths are from ONE simulator directory.">
                            Output Plots:
                        </label>
                        <input type="text" id="analysisPlotsDir" name="plots_dir" value="plots/"
                            placeholder="e.g., plots/ or C:\simulations\plots" style="flex: 1;">
                    </div>
                </div>
                <!-- Hidden field to sync report dirs -->
                <input type="hidden" id="analysisReportDir" value="reports/">

                <!-- File Settings -->
                <h4 style="margin: 20px 0 15px 0; color: #475569;"><i class="fas fa-file-alt"
                        style="color: #10b981;"></i> File Settings</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label for="batchExtension" data-tooltip="File extension for ONE reports (usually .txt)">
                            Extension:
                        </label>
                        <input type="text" id="batchExtension" name="extension" value=".txt" placeholder=".txt">
                    </div>

                    <div class="form-group">
                        <label for="batchDataSeparator"
                            data-tooltip="Character separating keys from values inside report files. Usually ':' (e.g., 'delivery_prob: 0.85')">
                            Data Separator:
                        </label>
                        <input type="text" id="batchDataSeparator" name="data_separator" value=":" placeholder=":"
                            maxlength="3">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="batchPrecision" data-tooltip="Number of decimal places in averaged output values">
                            Output Precision:
                        </label>
                        <input type="number" id="batchPrecision" name="precision" min="1" max="10" value="4">
                    </div>
                </div>

                <!-- What to Analyze -->
                <h4 style="margin: 20px 0 15px 0; color: #475569;"><i class="fas fa-chart-bar"
                        style="color: #8b5cf6;"></i> Analysis Settings</h4>

                <div class="form-group">
                    <label for="analysisReportTypes"
                        data-tooltip="Report types to analyze - also used to filter files by name (only files containing the report type name will be processed)">
                        Report Types (Filename Filter):
                    </label>
                    <input id="analysisReportTypes" name="report_types" placeholder="Select or type report types">
                </div>

                <div class="form-group">
                    <label for="analysisMetrics"
                        data-tooltip="Metrics to include in plots (e.g., delivery_prob, latency_avg)">
                        Metrics to Plot:
                    </label>
                    <input id="analysisMetrics" name="metrics_include" placeholder="Select metrics">
                </div>

                <div class="form-group">
                    <label for="batchIgnoreFields"
                        data-tooltip="Fields to exclude during averaging (ignored in output)">
                        Ignore Fields:
                    </label>
                    <input id="batchIgnoreFields" name="ignore_fields" placeholder="Select fields to ignore">
                </div>

                <div class="form-group">
                    <label for="enabledPlotsTagify" data-tooltip="Types of visualizations to generate">
                        Enabled Plots:
                    </label>
                    <input id="enabledPlotsTagify" name="enabled_plots" placeholder="Select plots">
                </div>

                <!-- Average Groups - Standard Settings -->
                <h4 style="margin: 20px 0 10px; color: #475569;"><i class="fas fa-layer-group"
                        style="color: #8b5cf6;"></i> Average Groups</h4>
                <p style="color: #64748b; font-size: 13px; margin-bottom: 10px;">
                    How to group files for averaging (by router, TTL, etc.)
                </p>
                <table class="dynamic-table" id="batchAverageGroupsTable">
                    <thead>
                        <tr>
                            <th>Group Name</th>
                            <th>Group By</th>
                            <th>Min Files</th>
                            <th style="width: 60px;">Action</th>
                        </tr>
                    </thead>
                    <tbody id="batchAverageGroupsBody">
                        <!-- Default rows will be added by JS -->
                    </tbody>
                </table>
                <button type="button" class="add-button" style="margin-top: 10px;" onclick="addBatchAverageGroup()">
                    <i class="fas fa-plus"></i> Add Average Group
                </button>

                <!-- Advanced Settings -->
                <details class="advanced-settings">
                    <summary><i class="fas fa-cog"></i> Advanced Settings</summary>
                    <div class="advanced-content">
                        <!-- Informational Alert -->
                        <div
                            style="background: linear-gradient(135deg, #eff6ff 0%, #f0f9ff 100%); border: 1px solid #93c5fd; border-radius: 8px; padding: 12px 16px; margin-bottom: 20px;">
                            <p style="margin: 0; font-size: 13px; color: #1e40af;">
                                <i class="fas fa-info-circle" style="margin-right: 8px;"></i>
                                <strong>Advanced Configuration:</strong> These settings control how filenames are parsed
                                and how plot axes are labeled. Most users don't need to modify these.
                            </p>
                        </div>

                        <!-- Plot Thresholds Section -->
                        <h4 style="margin: 0 0 10px;"><i class="fas fa-chart-line"
                                style="color: #8b5cf6; margin-right: 8px;"></i>Plot Thresholds</h4>
                        <p style="color: #64748b; font-size: 13px; margin-bottom: 15px;">
                            Minimum data points required before generating specific plot types.
                        </p>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="analysisMinValuesLine"
                                    data-tooltip="Minimum unique values on X-axis needed to generate line plots">Min
                                    Values for Line Plot:</label>
                                <input type="number" id="analysisMinValuesLine" name="min_values_line" value="2"
                                    min="2">
                            </div>
                            <div class="form-group">
                                <label for="analysisMinValuesSurface"
                                    data-tooltip="Minimum unique values needed on each axis for surface/3D plots">Min
                                    Values for Surface Plot:</label>
                                <input type="number" id="analysisMinValuesSurface" name="min_values_surface" value="3"
                                    min="2">
                            </div>
                            <div class="form-group">
                                <label for="analysisMinFilesHeatmap"
                                    data-tooltip="Minimum number of report files needed to generate correlation heatmaps">Min
                                    Files for Heatmap:</label>
                                <input type="number" id="analysisMinFilesHeatmap" name="min_files_heatmap" value="2"
                                    min="2">
                            </div>
                        </div>

                        <!-- Filename Parsing Section -->
                        <h4 style="margin: 20px 0 10px;"><i class="fas fa-file-code"
                                style="color: #10b981; margin-right: 8px;"></i>Filename Parsing</h4>
                        <p style="color: #64748b; font-size: 13px; margin-bottom: 15px;">
                            Position of components in your report filenames (0-indexed). For filename <code
                                style="background: #f1f5f9; padding: 2px 6px; border-radius: 4px;">MessageStats_EpidemicRouter_TTL300.txt</code>,
                            Report Type is at position 0, Router at 1.
                        </p>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="analysisReportTypePos"
                                    data-tooltip="Position of report type in filename (e.g., MessageStats)">Report Type
                                    Position:</label>
                                <input type="number" id="analysisReportTypePos" name="report_type_pos" value="0"
                                    min="-1">
                            </div>
                            <div class="form-group">
                                <label for="analysisRouterPos"
                                    data-tooltip="Position of router name in filename (e.g., EpidemicRouter)">Router
                                    Position:</label>
                                <input type="number" id="analysisRouterPos" name="router_pos" value="1" min="-1">
                            </div>
                            <div class="form-group">
                                <label for="analysisGroupingTypePos"
                                    data-tooltip="Position of grouping type in filename (set to -1 if not present)">Grouping
                                    Type Position:</label>
                                <input type="number" id="analysisGroupingTypePos" name="grouping_type_pos" value="-1"
                                    min="-1">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="analysisFilenameDelimiter"
                                    data-tooltip="Character used to separate components in filenames (usually underscore)">Filename
                                    Delimiter:</label>
                                <input type="text" id="analysisFilenameDelimiter" value="_" maxlength="3"
                                    style="max-width: 100px;">
                            </div>
                            <div class="form-group">
                                <label for="analysisDataSeparator"
                                    data-tooltip="Character separating keys from values inside report files">Data
                                    Separator:</label>
                                <input type="text" id="analysisDataSeparator" value=":" maxlength="3"
                                    style="max-width: 100px;">
                            </div>
                            <div class="form-group">
                                <label for="analysisReportExtension" data-tooltip="File extension of report files">File
                                    Extension:</label>
                                <input type="text" id="analysisReportExtension" value=".txt" maxlength="10"
                                    style="max-width: 100px;">
                            </div>
                        </div>
                        <input type="hidden" id="analysisIgnoreMetrics" value="">

                        <!-- Grouping Labels Section -->
                        <h4 style="margin: 20px 0 10px;"><i class="fas fa-tags"
                                style="color: #f59e0b; margin-right: 8px;"></i>Axis Labels</h4>
                        <p style="color: #64748b; font-size: 13px; margin-bottom: 15px;">
                            Map grouping types (from filenames) to human-readable labels for plot axes. For example, map
                            "TTL" to "Message TTL (minutes)" or "buffer" to "Buffer Size (MB)".
                        </p>
                        <table class="dynamic-table" id="analysisGroupingLabelsTable">
                            <thead>
                                <tr>
                                    <th data-tooltip="The grouping type as it appears in your filenames">Grouping Type
                                    </th>
                                    <th data-tooltip="Human-readable label shown on plot axes">Display Label</th>
                                    <th style="width: 60px;">Action</th>
                                </tr>
                            </thead>
                            <tbody id="analysisGroupingLabelsBody">
                                <!-- Dynamic rows -->
                            </tbody>
                        </table>
                        <button type="button" class="add-button" style="margin-top: 10px;"
                            onclick="addAnalysisGroupingLabel()">
                            <i class="fas fa-plus"></i> Add Label Mapping
                        </button>
                    </div>
                </details>
            </form>
        </fieldset>

        <!-- Machine Learning Config Section -->
        <fieldset id="regressionConfigSection">
            <legend><i class="fas fa-brain"></i> Machine Learning Configuration</legend>
            <form id="regressionConfigForm">
                <div class="checkbox-container"
                    style="margin-bottom: 15px; padding: 10px; background: rgba(99, 102, 241, 0.1); border-radius: 8px;">
                    <input type="checkbox" id="enableML" name="enable_ml">
                    <label for="enableML" style="font-weight: 600;">Enable Machine Learning Analysis</label>
                    <p style="margin: 8px 0 0 24px; font-size: 12px; color: #64748b;">
                        <i class="fas fa-info-circle"></i> Uses CSV files from the Output Plots folder above
                    </p>
                </div>
                <!-- Hidden field to sync with plots directory -->
                <input type="hidden" id="regressionCsvDir" value="plots/">

                <div class="form-row">
                    <div class="form-group">
                        <label for="regressionOutputDir"
                            data-tooltip="Directory where ML analysis results and plots will be saved">
                            Results Folder:
                        </label>
                        <input type="text" id="regressionOutputDir" name="output_directory" value="regression_results/"
                            placeholder="e.g., regression_results/ or C:\ml_results">
                    </div>
                    <div class="form-group">
                        <label for="regressionTarget"
                            data-tooltip="Target variable(s) to predict. Add multiple targets to run separate analyses for each.">
                            Target Variable(s):
                        </label>
                        <input id="regressionTarget" name="target" placeholder="Select or type target metrics">
                        <p style="margin: 5px 0 0 0; font-size: 11px; color: #64748b;">
                            <i class="fas fa-lightbulb" style="color: #f59e0b;"></i>
                            Multiple targets will generate separate results for each
                        </p>
                    </div>
                </div>

                <div class="form-group">
                    <label for="regressionPredictors"
                        data-tooltip="Features used for prediction. Leave empty to auto-select all numeric columns.">
                        Predictor Variables:
                    </label>
                    <input id="regressionPredictors" name="predictors" placeholder="Leave empty for auto-selection">
                </div>

                <div class="form-group">
                    <label for="regressionExclude"
                        data-tooltip="Variables to exclude from auto-selection during prediction (e.g., identifiers like seed, run_id)">
                        Exclude Variables:
                    </label>
                    <input id="regressionExclude" name="exclude"
                        placeholder="Variables to exclude (e.g., seed, run_id)">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="regressionTrainSize"
                            data-tooltip="Fraction of data for training. 0.75 = 75% train, 25% test. Higher = more training data.">Train
                            Size (0-1):</label>
                        <input type="number" id="regressionTrainSize" name="train_size" step="0.05" min="0.1" max="0.95"
                            value="0.75">
                    </div>
                    <div class="form-group">
                        <label for="regressionRandomState"
                            data-tooltip="Seed for reproducibility. Use the same value to get identical results across runs.">Random
                            State:</label>
                        <input type="number" id="regressionRandomState" name="random_state" min="0" value="5">
                    </div>
                </div>

                <div class="form-group">
                    <label for="enabledModelsTagify"
                        data-tooltip="Machine learning algorithms to train and compare. Multiple models will show performance comparison.">Enabled
                        Models:</label>
                    <input id="enabledModelsTagify" name="enabled_models" placeholder="Select models to enable">
                </div>

                <div class="form-row">
                    <div class="checkbox-container">
                        <input type="checkbox" id="regressionNormalize" name="normalize" checked>
                        <label for="regressionNormalize"
                            data-tooltip="Scale features to have mean=0, std=1. Recommended for most algorithms.">Normalize
                            Features</label>
                    </div>
                    <div class="checkbox-container">
                        <input type="checkbox" id="polyEnabled" name="polynomial_enabled" checked>
                        <label for="polyEnabled"
                            data-tooltip="Create interaction terms between features (e.g., TTL × Buffer). May improve accuracy.">Polynomial
                            Features</label>
                    </div>
                    <div class="checkbox-container">
                        <input type="checkbox" id="regressionCVEnabled" name="cv_enabled" checked>
                        <label for="regressionCVEnabled"
                            data-tooltip="Use k-fold cross-validation for more robust model evaluation and reduce overfitting.">Cross
                            Validation</label>
                    </div>
                </div>

                <!-- Advanced Regression Settings -->
                <details class="advanced-settings">
                    <summary><i class="fas fa-cog"></i> Advanced Settings</summary>
                    <div class="advanced-content">
                        <!-- Informational Alert -->
                        <div
                            style="background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%); border: 1px solid #c4b5fd; border-radius: 8px; padding: 12px 16px; margin-bottom: 20px;">
                            <p style="margin: 0; font-size: 13px; color: #6b21a8;">
                                <i class="fas fa-flask" style="margin-right: 8px;"></i>
                                <strong>Model Tuning:</strong> Fine-tune machine learning algorithm parameters. Default
                                values work well for most datasets.
                            </p>
                        </div>

                        <h4 style="margin: 15px 0 10px;"><i class="fas fa-superscript"
                                style="color: #8b5cf6; margin-right: 8px;"></i>Polynomial Features</h4>
                        <p style="color: #64748b; font-size: 13px; margin-bottom: 15px;">
                            Create interaction terms between predictor variables to capture non-linear relationships.
                        </p>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="polyDegree"
                                    data-tooltip="Maximum degree of polynomial features. Higher = more complex interactions but risk of overfitting">Degree:</label>
                                <input type="number" id="polyDegree" name="poly_degree" value="2" min="1" max="5">
                            </div>
                            <div class="checkbox-container">
                                <input type="checkbox" id="polyInteractionOnly" name="poly_interaction_only" checked>
                                <label for="polyInteractionOnly"
                                    data-tooltip="Only include interaction terms (e.g., x1*x2) without powers (e.g., x1², x2²). Reduces feature count">Interaction
                                    Only</label>
                            </div>
                            <div class="checkbox-container">
                                <input type="checkbox" id="polyIncludeBias" name="poly_include_bias">
                                <label for="polyIncludeBias"
                                    data-tooltip="Include a bias/intercept column of ones. Usually not needed if model has its own intercept">Include
                                    Bias</label>
                            </div>
                        </div>

                        <h4 style="margin: 15px 0 10px;"><i class="fas fa-sync-alt"
                                style="color: #10b981; margin-right: 8px;"></i>Cross Validation</h4>
                        <p style="color: #64748b; font-size: 13px; margin-bottom: 15px;">
                            Split data into K folds for more reliable model evaluation.
                        </p>
                        <div class="form-group">
                            <label for="regressionCVFolds"
                                data-tooltip="Number of data splits. Higher = more reliable but slower. 5-10 is typical">Number
                                of Folds:</label>
                            <input type="number" id="regressionCVFolds" name="cv_folds" value="5" min="2" max="20"
                                style="max-width: 150px;">
                        </div>

                        <h4 style="margin: 15px 0 10px;"><i class="fas fa-sliders-h"
                                style="color: #f59e0b; margin-right: 8px;"></i>Model Parameters</h4>
                        <p style="color: #64748b; font-size: 13px; margin-bottom: 15px;">
                            Algorithm-specific hyperparameters for fine-tuning model performance.
                        </p>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="knnNeighbors"
                                    data-tooltip="Number of nearest neighbors to consider. Lower = more sensitive to noise, Higher = smoother predictions">KNN
                                    Neighbors:</label>
                                <input type="number" id="knnNeighbors" name="knn_neighbors" value="6" min="1">
                            </div>
                            <div class="form-group">
                                <label for="dtMaxDepth"
                                    data-tooltip="Maximum tree depth. Lower = simpler model (less overfitting), Leave empty for unlimited">Decision
                                    Tree Max Depth:</label>
                                <input type="number" id="dtMaxDepth" name="dt_max_depth"
                                    placeholder="Empty = unlimited">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="rfEstimators"
                                    data-tooltip="Number of trees in Random Forest. More trees = better accuracy but slower training">Random
                                    Forest Trees:</label>
                                <input type="number" id="rfEstimators" name="rf_estimators" value="100" min="1">
                            </div>
                            <div class="form-group">
                                <label for="gbEstimators"
                                    data-tooltip="Number of boosting stages (trees) in Gradient Boosting. More = better fit but risk of overfitting">GB
                                    Boosting Stages:</label>
                                <input type="number" id="gbEstimators" name="gb_estimators" value="100" min="1">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="gbLearningRate"
                                    data-tooltip="Step size for each boosting iteration. Lower = more robust but needs more estimators">GB
                                    Learning Rate:</label>
                                <input type="number" id="gbLearningRate" name="gb_learning_rate" value="0.1" step="0.01"
                                    min="0.01" max="1">
                            </div>
                            <div class="form-group">
                                <label for="gbMaxDepth"
                                    data-tooltip="Maximum depth of individual trees in Gradient Boosting. Lower = simpler weak learners">GB
                                    Max Depth:</label>
                                <input type="number" id="gbMaxDepth" name="gb_max_depth" value="3" min="1">
                            </div>
                        </div>
                    </div>
                </details>
            </form>
        </fieldset>
    </div>

    <script src="/GUI/pattern-builder.js"></script>
    <script src="/GUI/console-log.js"></script>
    <script src="/GUI/config.js"></script>

    <!-- WKT Form JavaScript -->
    <script>
        // Auto-generate filename from location
        document.getElementById('wkt_location').addEventListener('input', function () {
            const location = this.value.toLowerCase().replace(/[^a-z0-9]/g, '_').replace(/_+/g, '_');
            if (location) {
                document.getElementById('wkt_output_name').value = location;
            }
        });

        // Test location availability
        document.getElementById('wktTestLocation').addEventListener('click', function () {
            const location = document.getElementById('wkt_location').value.trim();
            const statusDiv = document.getElementById('wktLocationStatus');
            const button = this;

            if (!location) {
                statusDiv.innerHTML = 'Please enter a location first';
                statusDiv.className = 'alert alert-warning';
                statusDiv.style.display = 'block';
                return;
            }

            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Testing...';
            statusDiv.style.display = 'none';

            fetch('http://localhost:5000/test_city', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ city_name: location })
            })
                .then(response => response.json())
                .then(data => {
                    statusDiv.innerHTML = data.message;
                    statusDiv.className = 'alert ' + (data.available ? 'alert-success' : 'alert-warning');
                    statusDiv.style.display = 'block';
                })
                .catch(error => {
                    statusDiv.innerHTML = 'Error testing location';
                    statusDiv.className = 'alert alert-danger';
                    statusDiv.style.display = 'block';
                })
                .finally(() => {
                    button.disabled = false;
                    button.innerHTML = '<i class="fas fa-search"></i> Test';
                });
        });

        // Form validation
        document.getElementById('wktMapForm').addEventListener('submit', function (e) {
            const location = document.getElementById('wkt_location').value.trim();
            const outputName = document.getElementById('wkt_output_name').value.trim();

            if (!location) {
                e.preventDefault();
                alert('Please enter a location');
                return;
            }

            if (!outputName || !/^[a-zA-Z0-9_-]+$/.test(outputName)) {
                e.preventDefault();
                alert('Please enter a valid filename (letters, numbers, underscores, and hyphens only)');
                return;
            }
        });
    </script>

    <!-- Directory Browser Component -->
    <script src="/GUI/directory-browser.js"></script>

    <!-- Auto-Save Manager -->
    <script src="/GUI/auto-save.js"></script>

    <!-- Pattern Builder Component -->
    <script src="/GUI/pattern-builder.js"></script>
</body>

</html>